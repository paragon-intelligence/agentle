<!doctype html>
<html class="no-js" lang="en" data-content_root="../../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>agentle.agents.agent - Agentle 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #2980B9;
  --color-brand-content: #2980B9;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #4DA3E2;
  --color-brand-content: #4DA3E2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #4DA3E2;
  --color-brand-content: #4DA3E2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">Agentle 0.1.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../../_static/logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Agentle 0.1.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../agents.html">Agents</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../inputs.html">Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structured_outputs.html">Structured Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../prompt_management.html">Prompt Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../knowledge_integration.html">Knowledge Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../agent_composition.html">Agent Composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../a2a.html">A2A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mcp.html">Model Context Protocol (MCP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../observability.html">Observability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/agents.html">Agents API</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Agents API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.html">agentle.agents</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of agentle.agents</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.html">agentle.agents.a2a</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.a2a_interface.html">agentle.agents.a2a.a2a_interface</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.a2a_interface_options.html">agentle.agents.a2a.a2a_interface_options</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.html">agentle.agents.a2a.message_parts</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.message_parts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.html">agentle.agents.a2a.message_parts.adapters</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.message_parts.adapters</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.agent_part_to_generation_part_adapter.html">agentle.agents.a2a.message_parts.adapters.agent_part_to_generation_part_adapter</a></li>
<li class="toctree-l7"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.generation_part_to_agent_part_adapter.html">agentle.agents.a2a.message_parts.adapters.generation_part_to_agent_part_adapter</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.data_part.html">agentle.agents.a2a.message_parts.data_part</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.file_part.html">agentle.agents.a2a.message_parts.file_part</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.text_part.html">agentle.agents.a2a.message_parts.text_part</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.html">agentle.agents.a2a.messages</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.messages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.generation_message_to_message_adapter.html">agentle.agents.a2a.messages.generation_message_to_message_adapter</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.message.html">agentle.agents.a2a.messages.message</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.message_to_generation_message_adapter.html">agentle.agents.a2a.messages.message_to_generation_message_adapter</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.html">agentle.agents.a2a.models</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.agent_skill.html">agentle.agents.a2a.models.agent_skill</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.agent_usage_statistics.html">agentle.agents.a2a.models.agent_usage_statistics</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.artifact.html">agentle.agents.a2a.models.artifact</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.authentication.html">agentle.agents.a2a.models.authentication</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.capabilities.html">agentle.agents.a2a.models.capabilities</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.file.html">agentle.agents.a2a.models.file</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.json_rpc_error.html">agentle.agents.a2a.models.json_rpc_error</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.json_rpc_response.html">agentle.agents.a2a.models.json_rpc_response</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.run_state.html">agentle.agents.a2a.models.run_state</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.html">agentle.agents.a2a.notifications</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.notifications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.push_notification_config.html">agentle.agents.a2a.notifications.push_notification_config</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.task_push_notification_config.html">agentle.agents.a2a.notifications.task_push_notification_config</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.html">agentle.agents.a2a.resources</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.resources</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.push_notification_resource.html">agentle.agents.a2a.resources.push_notification_resource</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.task_resource.html">agentle.agents.a2a.resources.task_resource</a></li>
</ul>
</li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.html">agentle.agents.a2a.tasks</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.tasks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.html">agentle.agents.a2a.tasks.managment</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.tasks.managment</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.in_memory.html">agentle.agents.a2a.tasks.managment.in_memory</a></li>
<li class="toctree-l7"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.task_manager.html">agentle.agents.a2a.tasks.managment.task_manager</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.send_task_request.html">agentle.agents.a2a.tasks.send_task_request</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.send_task_response.html">agentle.agents.a2a.tasks.send_task_response</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task.html">agentle.agents.a2a.tasks.task</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_artifact_update_event.html">agentle.agents.a2a.tasks.task_artifact_update_event</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_get_result.html">agentle.agents.a2a.tasks.task_get_result</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_query_params.html">agentle.agents.a2a.tasks.task_query_params</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_send_params.html">agentle.agents.a2a.tasks.task_send_params</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_state.html">agentle.agents.a2a.tasks.task_state</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_status.html">agentle.agents.a2a.tasks.task_status</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_status_update_event.html">agentle.agents.a2a.tasks.task_status_update_event</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent.html">agentle.agents.agent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_config.html">agentle.agents.agent_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_config_dict.html">agentle.agents.agent_config_dict</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_input.html">agentle.agents.agent_input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_pipeline.html">agentle.agents.agent_pipeline</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_run_output.html">agentle.agents.agent_run_output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_team.html">agentle.agents.agent_team</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.asgi.html">agentle.agents.asgi</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of agentle.agents.asgi</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.asgi.blacksheep.html">agentle.agents.asgi.blacksheep</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.context.html">agentle.agents.context</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.errors.html">agentle.agents.errors</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of agentle.agents.errors</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.errors.max_tool_calls_exceeded_error.html">agentle.agents.errors.max_tool_calls_exceeded_error</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.exceptions.html">agentle.agents.exceptions</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of agentle.agents.exceptions</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.exceptions.skip_tool_call_error.html">agentle.agents.exceptions.skip_tool_call_error</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.exceptions.stop_agent_error.html">agentle.agents.exceptions.stop_agent_error</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.html">agentle.agents.knowledge</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of agentle.agents.knowledge</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.document_knowledge.html">agentle.agents.knowledge.document_knowledge</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.static_knowledge.html">agentle.agents.knowledge.static_knowledge</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.url_knowledge.html">agentle.agents.knowledge.url_knowledge</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.step.html">agentle.agents.step</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.ui.html">agentle.agents.ui</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of agentle.agents.ui</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.ui.streamlit.html">agentle.agents.ui.streamlit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent.html">agentle.agents.agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_pipeline.html">agentle.agents.agent_pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_team.html">agentle.agents.agent_team</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.context.html">agentle.agents.context</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_config.html">agentle.agents.agent_config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_input.html">agentle.agents.agent_input</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.agent_run_output.html">agentle.agents.agent_run_output</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.html">agentle.agents.knowledge</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of agentle.agents.knowledge</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.document_knowledge.html">agentle.agents.knowledge.document_knowledge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.static_knowledge.html">agentle.agents.knowledge.static_knowledge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.knowledge.url_knowledge.html">agentle.agents.knowledge.url_knowledge</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.html">agentle.agents.a2a</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.a2a_interface.html">agentle.agents.a2a.a2a_interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.a2a_interface_options.html">agentle.agents.a2a.a2a_interface_options</a></li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.html">agentle.agents.a2a.message_parts</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.message_parts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.html">agentle.agents.a2a.message_parts.adapters</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.message_parts.adapters</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.agent_part_to_generation_part_adapter.html">agentle.agents.a2a.message_parts.adapters.agent_part_to_generation_part_adapter</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.adapters.generation_part_to_agent_part_adapter.html">agentle.agents.a2a.message_parts.adapters.generation_part_to_agent_part_adapter</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.data_part.html">agentle.agents.a2a.message_parts.data_part</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.file_part.html">agentle.agents.a2a.message_parts.file_part</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.message_parts.text_part.html">agentle.agents.a2a.message_parts.text_part</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.html">agentle.agents.a2a.messages</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.messages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.generation_message_to_message_adapter.html">agentle.agents.a2a.messages.generation_message_to_message_adapter</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.message.html">agentle.agents.a2a.messages.message</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.messages.message_to_generation_message_adapter.html">agentle.agents.a2a.messages.message_to_generation_message_adapter</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.html">agentle.agents.a2a.models</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.agent_skill.html">agentle.agents.a2a.models.agent_skill</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.agent_usage_statistics.html">agentle.agents.a2a.models.agent_usage_statistics</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.artifact.html">agentle.agents.a2a.models.artifact</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.authentication.html">agentle.agents.a2a.models.authentication</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.capabilities.html">agentle.agents.a2a.models.capabilities</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.file.html">agentle.agents.a2a.models.file</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.json_rpc_error.html">agentle.agents.a2a.models.json_rpc_error</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.json_rpc_response.html">agentle.agents.a2a.models.json_rpc_response</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.models.run_state.html">agentle.agents.a2a.models.run_state</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.html">agentle.agents.a2a.notifications</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.notifications</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.push_notification_config.html">agentle.agents.a2a.notifications.push_notification_config</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.notifications.task_push_notification_config.html">agentle.agents.a2a.notifications.task_push_notification_config</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.html">agentle.agents.a2a.resources</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.resources</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.push_notification_resource.html">agentle.agents.a2a.resources.push_notification_resource</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.resources.task_resource.html">agentle.agents.a2a.resources.task_resource</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.html">agentle.agents.a2a.tasks</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.tasks</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.html">agentle.agents.a2a.tasks.managment</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of agentle.agents.a2a.tasks.managment</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.in_memory.html">agentle.agents.a2a.tasks.managment.in_memory</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.managment.task_manager.html">agentle.agents.a2a.tasks.managment.task_manager</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.send_task_request.html">agentle.agents.a2a.tasks.send_task_request</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.send_task_response.html">agentle.agents.a2a.tasks.send_task_response</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task.html">agentle.agents.a2a.tasks.task</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_artifact_update_event.html">agentle.agents.a2a.tasks.task_artifact_update_event</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_get_result.html">agentle.agents.a2a.tasks.task_get_result</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_query_params.html">agentle.agents.a2a.tasks.task_query_params</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_send_params.html">agentle.agents.a2a.tasks.task_send_params</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_state.html">agentle.agents.a2a.tasks.task_state</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_status.html">agentle.agents.a2a.tasks.task_status</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.agents.a2a.tasks.task_status_update_event.html">agentle.agents.a2a.tasks.task_status_update_event</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/generations.html">Generations API</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of Generations API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.generations.html">agentle.generations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.generations.providers.html">agentle.generations.providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.generations.providers.google.html">agentle.generations.providers.google</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.generations.providers.openai.html">agentle.generations.providers.openai</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/prompts.html">Prompts API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/mcp.html">MCP API</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle navigation of MCP API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.html">agentle.mcp</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle navigation of agentle.mcp</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.errors.html">agentle.mcp.errors</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle navigation of agentle.mcp.errors</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.errors.error_code.html">agentle.mcp.errors.error_code</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.html">agentle.mcp.models</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle navigation of agentle.mcp.models</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.annotations.html">agentle.mcp.models.annotations</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.blob_resource_contents.html">agentle.mcp.models.blob_resource_contents</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.call_tool_result.html">agentle.mcp.models.call_tool_result</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.embedded_resource.html">agentle.mcp.models.embedded_resource</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.image_content.html">agentle.mcp.models.image_content</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.resource_contents.html">agentle.mcp.models.resource_contents</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.role.html">agentle.mcp.models.role</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.text_content.html">agentle.mcp.models.text_content</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.models.text_resource_contents.html">agentle.mcp.models.text_resource_contents</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.prompts.html">agentle.mcp.prompts</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle navigation of agentle.mcp.prompts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.prompts.prompt.html">agentle.mcp.prompts.prompt</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.prompts.prompt_argument.html">agentle.mcp.prompts.prompt_argument</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.html">agentle.mcp.resources</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle navigation of agentle.mcp.resources</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.html">agentle.mcp.resources.binary_resources</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle navigation of agentle.mcp.resources.binary_resources</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.audio_files.html">agentle.mcp.resources.binary_resources.audio_files</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.base64_convertible.html">agentle.mcp.resources.binary_resources.base64_convertible</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.image.html">agentle.mcp.resources.binary_resources.image</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.pdfs.html">agentle.mcp.resources.binary_resources.pdfs</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.binary_resources.video_files.html">agentle.mcp.resources.binary_resources.video_files</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.resource_content.html">agentle.mcp.resources.resource_content</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.resource_description.html">agentle.mcp.resources.resource_description</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.resource_description_with_template.html">agentle.mcp.resources.resource_description_with_template</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.html">agentle.mcp.resources.text_resources</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle navigation of agentle.mcp.resources.text_resources</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.configuration_file.html">agentle.mcp.resources.text_resources.configuration_file</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.json_data.html">agentle.mcp.resources.text_resources.json_data</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.log_file.html">agentle.mcp.resources.text_resources.log_file</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.plain_text.html">agentle.mcp.resources.text_resources.plain_text</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.source_code.html">agentle.mcp.resources.text_resources.source_code</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.textfyable.html">agentle.mcp.resources.text_resources.textfyable</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.resources.text_resources.xml_data.html">agentle.mcp.resources.text_resources.xml_data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.roots.html">agentle.mcp.roots</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle navigation of agentle.mcp.roots</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.roots.root.html">agentle.mcp.roots.root</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.html">agentle.mcp.sampling</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle navigation of agentle.mcp.sampling</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.completion_result.html">agentle.mcp.sampling.completion_result</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.hint.html">agentle.mcp.sampling.hint</a></li>
<li class="toctree-l5 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.html">agentle.mcp.sampling.messages</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle navigation of agentle.mcp.sampling.messages</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.assistant_message.html">agentle.mcp.sampling.messages.assistant_message</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.image_message_content.html">agentle.mcp.sampling.messages.image_message_content</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.message.html">agentle.mcp.sampling.messages.message</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.text_message_content.html">agentle.mcp.sampling.messages.text_message_content</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.messages.user_message.html">agentle.mcp.sampling.messages.user_message</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.model_preferences.html">agentle.mcp.sampling.model_preferences</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.sampling.request.html">agentle.mcp.sampling.request</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.html">agentle.mcp.servers</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle navigation of agentle.mcp.servers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.mcp_server_protocol.html">agentle.mcp.servers.mcp_server_protocol</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.stdio_mcp_server.html">agentle.mcp.servers.stdio_mcp_server</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.streamable_http_mcp_server.html">agentle.mcp.servers.streamable_http_mcp_server</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.html">agentle.mcp.session_management</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle navigation of agentle.mcp.session_management</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.in_memory.html">agentle.mcp.session_management.in_memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.redis.html">agentle.mcp.session_management.redis</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.session_manager.html">agentle.mcp.session_management.session_manager</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.tools.html">agentle.mcp.tools</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle navigation of agentle.mcp.tools</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.tools.input_schema.html">agentle.mcp.tools.input_schema</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.tools.mcp_tool.html">agentle.mcp.tools.mcp_tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.html">agentle.mcp.servers</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle navigation of agentle.mcp.servers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.mcp_server_protocol.html">agentle.mcp.servers.mcp_server_protocol</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.stdio_mcp_server.html">agentle.mcp.servers.stdio_mcp_server</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.servers.streamable_http_mcp_server.html">agentle.mcp.servers.streamable_http_mcp_server</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.html">agentle.mcp.session_management</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle navigation of agentle.mcp.session_management</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.in_memory.html">agentle.mcp.session_management.in_memory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.redis.html">agentle.mcp.session_management.redis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/_autosummary/agentle.mcp.session_management.session_manager.html">agentle.mcp.session_management.session_manager</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/rag.html">RAG API</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/stt.html">Speech-to-Text API</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle navigation of Speech-to-Text API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.stt.html">agentle.stt</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../api/tts.html">Text-to-Speech API</a><input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" role="switch" type="checkbox"/><label for="toctree-checkbox-46"><div class="visually-hidden">Toggle navigation of Text-to-Speech API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/generated/agentle.tts.html">agentle.tts</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <h1>Source code for agentle.agents.agent</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The main module of the Agentle framework for creating and managing AI agents.</span>

<span class="sd">This module contains the definition of the Agent class, which is the central component of the Agentle framework.</span>
<span class="sd">It allows you to create intelligent agents capable of processing different types of input,</span>
<span class="sd">using external tools, and generating structured responses. The Agent facilitates integration</span>
<span class="sd">with different AI model providers and supports a wide variety of input formats.</span>

<span class="sd">Basic example:</span>
<span class="sd">```python</span>
<span class="sd">from agentle.generations.providers.google.google_generation_provider import GoogleGenerationProvider</span>
<span class="sd">from agentle.agents.agent import Agent</span>

<span class="sd">weather_agent = Agent(</span>
<span class="sd">    generation_provider=GoogleGenerationProvider(),</span>
<span class="sd">    model=&quot;gemini-2.0-flash&quot;,</span>
<span class="sd">    instructions=&quot;You are a weather agent that can answer questions about the weather.&quot;,</span>
<span class="sd">    tools=[get_weather],</span>
<span class="sd">)</span>

<span class="sd">output = weather_agent.run(&quot;Hello. What is the weather in Tokyo?&quot;)</span>
<span class="sd">```</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># pyright: reportGeneralTypeIssues=false</span>
<span class="c1"># type: ignore[reportGeneralTypeIssues]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">importlib.util</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">AsyncGenerator</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
    <span class="n">Generator</span><span class="p">,</span>
    <span class="n">MutableMapping</span><span class="p">,</span>
    <span class="n">MutableSequence</span><span class="p">,</span>
    <span class="n">Sequence</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">asynccontextmanager</span><span class="p">,</span> <span class="n">contextmanager</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span><span class="p">,</span> <span class="n">StringIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.containers.maybe</span><span class="w"> </span><span class="kn">import</span> <span class="n">Maybe</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.coroutines.run_sync</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_sync</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.models.base_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.models.config_dict</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.models.field</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rsb.models.mimetype</span><span class="w"> </span><span class="kn">import</span> <span class="n">MimeType</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.a2a.models.agent_skill</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentSkill</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.a2a.models.authentication</span><span class="w"> </span><span class="kn">import</span> <span class="n">Authentication</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.a2a.models.capabilities</span><span class="w"> </span><span class="kn">import</span> <span class="n">Capabilities</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.a2a.models.run_state</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentConfig</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_config_dict</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentConfigDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_input</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_run_output</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentRunOutput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">Context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.errors.max_tool_calls_exceeded_error</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">MaxToolCallsExceededError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.knowledge.static_knowledge</span><span class="w"> </span><span class="kn">import</span> <span class="n">NO_CACHE</span><span class="p">,</span> <span class="n">StaticKnowledge</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.step</span><span class="w"> </span><span class="kn">import</span> <span class="n">Step</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.collections.message_sequence</span><span class="w"> </span><span class="kn">import</span> <span class="n">MessageSequence</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.generation.generation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Generation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.generation.trace_params</span><span class="w"> </span><span class="kn">import</span> <span class="n">TraceParams</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.message_parts.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">FilePart</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.message_parts.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextPart</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.message_parts.tool_execution_suggestion</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ToolExecutionSuggestion</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.messages.assistant_message</span><span class="w"> </span><span class="kn">import</span> <span class="n">AssistantMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.messages.developer_message</span><span class="w"> </span><span class="kn">import</span> <span class="n">DeveloperMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.models.messages.user_message</span><span class="w"> </span><span class="kn">import</span> <span class="n">UserMessage</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.providers.base.generation_provider</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">GenerationProvider</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.providers.types.model_kind</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelKind</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.tools.tool</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span>

<span class="c1"># from agentle.generations.tracing.langfuse import LangfuseObservabilityClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.mcp.servers.mcp_server_protocol</span><span class="w"> </span><span class="kn">import</span> <span class="n">MCPServerProtocol</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.parsing.document_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocumentParser</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.parsing.factories.file_parser_default_factory</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">file_parser_default_factory</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.parsing.parsed_document</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParsedDocument</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">agentle.prompts.models.prompt</span><span class="w"> </span><span class="kn">import</span> <span class="n">Prompt</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">mcp.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Tool</span> <span class="k">as</span> <span class="n">MCPTool</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_team</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentTeam</span>


<span class="nb">type</span> <span class="n">WithoutStructuredOutput</span> <span class="o">=</span> <span class="kc">None</span>
<span class="nb">type</span> <span class="n">_ToolName</span> <span class="o">=</span> <span class="nb">str</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># Check for optional dependencies</span>
<div class="viewcode-block" id="is_module_available">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.is_module_available">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">is_module_available</span><span class="p">(</span><span class="n">module_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a module is available without importing it.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">module_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span></div>



<span class="c1"># Pre-check for common optional dependencies</span>
<span class="n">HAS_PANDAS</span> <span class="o">=</span> <span class="n">is_module_available</span><span class="p">(</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>
<span class="n">HAS_NUMPY</span> <span class="o">=</span> <span class="n">is_module_available</span><span class="p">(</span><span class="s2">&quot;numpy&quot;</span><span class="p">)</span>
<span class="n">HAS_PIL</span> <span class="o">=</span> <span class="n">is_module_available</span><span class="p">(</span><span class="s2">&quot;PIL&quot;</span><span class="p">)</span>
<span class="n">HAS_PYDANTIC</span> <span class="o">=</span> <span class="n">is_module_available</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="Agent">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Agent</span><span class="p">[</span><span class="n">T_Schema</span> <span class="o">=</span> <span class="n">WithoutStructuredOutput</span><span class="p">](</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main class of the Agentle framework that represents an intelligent agent.</span>

<span class="sd">    An Agent is an entity that can process various types of input,</span>
<span class="sd">    perform tasks using tools, and generate responses that can be structured.</span>
<span class="sd">    It encapsulates all the logic needed to interact with AI models,</span>
<span class="sd">    manage context, call external tools, and format responses.</span>

<span class="sd">    The Agent class is generic and supports structured response types through</span>
<span class="sd">    the T_Schema type parameter, which can be a Pydantic class to define</span>
<span class="sd">    the expected output structure.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name: Human-readable name of the agent.</span>
<span class="sd">        description: Description of the agent, used for communication with users and other agents.</span>
<span class="sd">        url: URL where the agent is hosted.</span>
<span class="sd">        generation_provider: Generation provider used by the agent.</span>
<span class="sd">        version: Version of the agent.</span>
<span class="sd">        endpoint: Endpoint of the agent.</span>
<span class="sd">        documentationUrl: URL to agent documentation.</span>
<span class="sd">        capabilities: Optional capabilities supported by the agent.</span>
<span class="sd">        authentication: Authentication requirements for the agent.</span>
<span class="sd">        defaultInputModes: Input interaction modes supported by the agent.</span>
<span class="sd">        defaultOutputModes: Output interaction modes supported by the agent.</span>
<span class="sd">        skills: Skills that the agent can perform.</span>
<span class="sd">        model: Model to be used by the agent&#39;s service provider.</span>
<span class="sd">        instructions: Instructions for the agent.</span>
<span class="sd">        response_schema: Schema of the response to be returned by the agent.</span>
<span class="sd">        mcp_servers: MCP servers to be used by the agent.</span>
<span class="sd">        tools: Tools to be used by the agent.</span>
<span class="sd">        config: Configuration for the agent.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        from agentle.generations.providers.google.google_generation_provider import GoogleGenerationProvider</span>
<span class="sd">        from agentle.agents.agent import Agent</span>

<span class="sd">        # Define a simple tool</span>
<span class="sd">        def get_weather(location: str) -&gt; str:</span>
<span class="sd">            return f&quot;The weather in {location} is sunny.&quot;</span>

<span class="sd">        # Create a weather agent</span>
<span class="sd">        weather_agent = Agent(</span>
<span class="sd">            generation_provider=GoogleGenerationProvider(),</span>
<span class="sd">            model=&quot;gemini-2.0-flash&quot;,</span>
<span class="sd">            instructions=&quot;You are a weather agent that can answer questions about the weather.&quot;,</span>
<span class="sd">            tools=[get_weather],</span>
<span class="sd">        )</span>

<span class="sd">        # Run the agent</span>
<span class="sd">        output = weather_agent.run(&quot;What is the weather in London?&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">uid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A unique identifier for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Agent-to-agent protocol fields</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;Agent&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Human readable name of the agent.</span>
<span class="sd">    (e.g. &quot;Recipe Agent&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;An AI agent&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A human-readable description of the agent. Used to assist users and</span>
<span class="sd">    other agents in understanding what the agent can do.</span>
<span class="sd">    (e.g. &quot;Agent that helps users with recipes and cooking.&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;in-memory&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A URL to the address the agent is hosted at.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">static_knowledge</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">StaticKnowledge</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Static knowledge to be used by the agent. This will be used to enrich the agent&#39;s</span>
<span class="sd">    knowledge base. This will be FULLY (**entire document**) indexed to the conversation.</span>
<span class="sd">    This can be any url or a local file path.</span>
<span class="sd">    </span>
<span class="sd">    You can provide a cache duration (in seconds) to cache the parsed content for subsequent calls.</span>
<span class="sd">    Example:</span>
<span class="sd">    ```python</span>
<span class="sd">    agent = Agent(</span>
<span class="sd">        static_knowledge=[</span>
<span class="sd">            StaticKnowledge(content=&quot;https://example.com/data.pdf&quot;, cache=3600),  # Cache for 1 hour</span>
<span class="sd">            StaticKnowledge(content=&quot;local_file.txt&quot;, cache=&quot;infinite&quot;),  # Cache indefinitely</span>
<span class="sd">            &quot;raw text knowledge&quot;  # No caching (default)</span>
<span class="sd">        ]</span>
<span class="sd">    )</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Dear dev</span>
    <span class="c1"># Really sorry to use &quot;Any&quot; here. But if we use DocumentParser, we get an import cycle.</span>
    <span class="c1"># No worries, in the model_validator, we check if it&#39;s a DocumentParser.</span>
    <span class="n">document_parser</span><span class="p">:</span> <span class="n">DocumentParser</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A document parser to be used by the agent. This will be used to parse the static</span>
<span class="sd">    knowledge documents, if provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">generation_provider</span><span class="p">:</span> <span class="n">GenerationProvider</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The service provider of the agent</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_visual_description_provider</span><span class="p">:</span> <span class="n">GenerationProvider</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The service provider of the agent for visual description.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_audio_description_provider</span><span class="p">:</span> <span class="n">GenerationProvider</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The service provider of the agent for audio description.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0.0.1&quot;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The version of the agent - format is up to the provider. (e.g. &#39;1.0.0&#39;)&quot;</span><span class="p">,</span>
        <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;1.0.1&quot;</span><span class="p">,</span> <span class="s2">&quot;1.1.0&quot;</span><span class="p">],</span>
        <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;^\d+\.\d+\.\d+$&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The version of the agent - format is up to the provider. (e.g. &quot;1.0.0&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The endpoint of the agent&quot;</span><span class="p">,</span>
        <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;/api/v1/agents/weather-agent&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The endpoint of the agent</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">documentationUrl</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A URL to documentation for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">capabilities</span><span class="p">:</span> <span class="n">Capabilities</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">Capabilities</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Optional capabilities supported by the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">authentication</span><span class="p">:</span> <span class="n">Authentication</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Authentication</span><span class="p">(</span><span class="n">schemes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;basic&quot;</span><span class="p">])</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Authentication requirements for the agent.</span>
<span class="sd">    Intended to match OpenAPI authentication structure.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">defaultInputModes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MimeType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text/plain&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The set of interaction modes that the agent</span>
<span class="sd">    supports across all skills. This can be overridden per-skill.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">defaultOutputModes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MimeType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The set of interaction modes that the agent</span>
<span class="sd">    supports across all skills. This can be overridden per-skill.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">skills</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AgentSkill</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Skills are a unit of capability that an agent can perform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Library-specific fields</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">ModelKind</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The model to use for the agent&#39;s service provider.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Prompt</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant.&quot;</span>
    <span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The instructions to use for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">response_schema</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The schema of the response to be returned by the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mcp_servers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MCPServerProtocol</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The MCP servers to use for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tools</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tool</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The tools to use for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">config</span><span class="p">:</span> <span class="n">AgentConfig</span> <span class="o">|</span> <span class="n">AgentConfigDict</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AgentConfig</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The configuration for the agent.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Whether to debug each agent step using the logger.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Internal fields</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arbitrary_types_allowed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">agent_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentConfig</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">AgentConfig</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span>

<div class="viewcode-block" id="Agent.from_agent_card">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.from_agent_card">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_agent_card</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">agent_card</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Agent[Any]&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an Agent instance from an A2A agent card.</span>

<span class="sd">        This method parses an agent card dictionary and creates an Agent instance</span>
<span class="sd">        with the appropriate attributes. It maps the provider organization to a</span>
<span class="sd">        generation provider class if available.</span>

<span class="sd">        Args:</span>
<span class="sd">            agent_card: A dictionary representing an A2A agent card</span>

<span class="sd">        Returns:</span>
<span class="sd">            Agent[Any]: A new Agent instance based on the agent card</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If a required field is missing from the agent card</span>
<span class="sd">            ValueError: If the provider organization is specified but not supported</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Load an agent card from a file</span>
<span class="sd">            with open(&quot;agent_card.json&quot;, &quot;r&quot;) as f:</span>
<span class="sd">                agent_card = json.load(f)</span>

<span class="sd">            # Create an agent from the card</span>
<span class="sd">            agent = Agent.from_agent_card(agent_card)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Map provider organization to generation provider</span>
        <span class="n">provider</span> <span class="o">=</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;provider&quot;</span><span class="p">)</span>
        <span class="n">generation_provider</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">provider</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">org_name</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Handle each provider type with proper error handling</span>
            <span class="k">match</span> <span class="n">org_name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="k">case</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
                    <span class="c1"># Default to Google provider if available</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.providers.google</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                            <span class="n">google_generation_provider</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="n">generation_provider</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">google_generation_provider</span><span class="o">.</span><span class="n">GoogleGenerationProvider</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                        <span class="c1"># Fail silently and use fallback later</span>
                        <span class="k">pass</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unsupported (yet) provider organization: </span><span class="si">{</span><span class="n">org_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Convert skills</span>
        <span class="n">skills</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">AgentSkill</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">skill_data</span> <span class="ow">in</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;skills&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">skill</span> <span class="o">=</span> <span class="n">AgentSkill</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">skill_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())),</span>
                <span class="n">name</span><span class="o">=</span><span class="n">skill_data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">description</span><span class="o">=</span><span class="n">skill_data</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                <span class="n">tags</span><span class="o">=</span><span class="n">skill_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">examples</span><span class="o">=</span><span class="n">skill_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;examples&quot;</span><span class="p">),</span>
                <span class="n">inputModes</span><span class="o">=</span><span class="n">skill_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputModes&quot;</span><span class="p">),</span>
                <span class="n">outputModes</span><span class="o">=</span><span class="n">skill_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;outputModes&quot;</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">skills</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skill</span><span class="p">)</span>

        <span class="c1"># Create capabilities</span>
        <span class="n">capabilities_data</span> <span class="o">=</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capabilities&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">capabilities</span> <span class="o">=</span> <span class="n">Capabilities</span><span class="p">(</span>
            <span class="n">streaming</span><span class="o">=</span><span class="n">capabilities_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streaming&quot;</span><span class="p">),</span>
            <span class="n">pushNotifications</span><span class="o">=</span><span class="n">capabilities_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pushNotifications&quot;</span><span class="p">),</span>
            <span class="n">stateTransitionHistory</span><span class="o">=</span><span class="n">capabilities_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stateTransitionHistory&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Create authentication</span>
        <span class="n">auth_data</span> <span class="o">=</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authentication&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">authentication</span> <span class="o">=</span> <span class="n">Authentication</span><span class="p">(</span>
            <span class="n">schemes</span><span class="o">=</span><span class="n">auth_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;schemes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;basic&quot;</span><span class="p">]),</span>
            <span class="n">credentials</span><span class="o">=</span><span class="n">auth_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;credentials&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Default generation provider if none specified</span>
        <span class="k">if</span> <span class="n">generation_provider</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">agentle.generations.providers.google</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                    <span class="n">google_generation_provider</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">generation_provider</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">google_generation_provider</span><span class="o">.</span><span class="n">GoogleGenerationProvider</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="c1"># Create a minimal provider for type checking</span>
                <span class="n">generation_provider</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;DummyProvider&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">GenerationProvider</span><span class="p">,),</span> <span class="p">{})</span>

        <span class="c1"># Convert input/output modes to MimeType if they&#39;re strings</span>
        <span class="n">input_modes</span> <span class="o">=</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaultInputModes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;text/plain&quot;</span><span class="p">])</span>
        <span class="n">output_modes</span> <span class="o">=</span> <span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;defaultOutputModes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;text/plain&quot;</span><span class="p">])</span>

        <span class="c1"># Create agent instance</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">description</span><span class="o">=</span><span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
            <span class="n">url</span><span class="o">=</span><span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
            <span class="n">generation_provider</span><span class="o">=</span><span class="n">generation_provider</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span>
            <span class="n">documentationUrl</span><span class="o">=</span><span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;documentationUrl&quot;</span><span class="p">),</span>
            <span class="n">capabilities</span><span class="o">=</span><span class="n">capabilities</span><span class="p">,</span>
            <span class="n">authentication</span><span class="o">=</span><span class="n">authentication</span><span class="p">,</span>
            <span class="n">defaultInputModes</span><span class="o">=</span><span class="n">input_modes</span><span class="p">,</span>
            <span class="n">defaultOutputModes</span><span class="o">=</span><span class="n">output_modes</span><span class="p">,</span>
            <span class="n">skills</span><span class="o">=</span><span class="n">skills</span><span class="p">,</span>
            <span class="c1"># Default instructions based on description</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">agent_card</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;You are a helpful assistant.&quot;</span><span class="p">),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Agent.to_agent_card">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.to_agent_card">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">to_agent_card</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates an A2A agent card from this Agent instance.</span>

<span class="sd">        This method creates a dictionary representation of the agent in the A2A agent card</span>
<span class="sd">        format, including all relevant attributes such as name, description, capabilities,</span>
<span class="sd">        authentication, and skills.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: A dictionary representing the A2A agent card</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Create an agent</span>
<span class="sd">            agent = Agent(</span>
<span class="sd">                name=&quot;Weather Agent&quot;,</span>
<span class="sd">                description=&quot;An agent that provides weather information&quot;,</span>
<span class="sd">                generation_provider=GoogleGenerationProvider(),</span>
<span class="sd">                skills=[</span>
<span class="sd">                    AgentSkill(</span>
<span class="sd">                        name=&quot;Get Weather&quot;,</span>
<span class="sd">                        description=&quot;Gets the current weather for a location&quot;,</span>
<span class="sd">                        tags=[&quot;weather&quot;, &quot;forecast&quot;]</span>
<span class="sd">                    )</span>
<span class="sd">                ]</span>
<span class="sd">            )</span>

<span class="sd">            # Generate an agent card</span>
<span class="sd">            agent_card = agent.to_agent_card()</span>

<span class="sd">            # Save the agent card to a file</span>
<span class="sd">            with open(&quot;agent_card.json&quot;, &quot;w&quot;) as f:</span>
<span class="sd">                json.dump(agent_card, f, indent=2)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Determine provider information</span>
        <span class="n">provider_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">provider_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_provider</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="c1"># Map provider class to organization name</span>
        <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">provider_url</span> <span class="o">=</span> <span class="s2">&quot;https://example.com&quot;</span>  <span class="c1"># just for now.</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">provider_class</span><span class="p">,</span> <span class="s2">&quot;__module__&quot;</span><span class="p">):</span>
            <span class="n">module_name</span> <span class="o">=</span> <span class="n">provider_class</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;google&quot;</span> <span class="ow">in</span> <span class="n">module_name</span><span class="p">:</span>
                <span class="n">provider_name</span> <span class="o">=</span> <span class="s2">&quot;Google&quot;</span>
                <span class="n">provider_url</span> <span class="o">=</span> <span class="s2">&quot;https://ai.google.dev/&quot;</span>  <span class="c1"># just for now.</span>
            <span class="k">elif</span> <span class="s2">&quot;anthropic&quot;</span> <span class="ow">in</span> <span class="n">module_name</span><span class="p">:</span>
                <span class="n">provider_name</span> <span class="o">=</span> <span class="s2">&quot;Anthropic&quot;</span>
                <span class="n">provider_url</span> <span class="o">=</span> <span class="s2">&quot;https://anthropic.com/&quot;</span>  <span class="c1"># just for now.</span>
            <span class="k">elif</span> <span class="s2">&quot;openai&quot;</span> <span class="ow">in</span> <span class="n">module_name</span><span class="p">:</span>
                <span class="n">provider_name</span> <span class="o">=</span> <span class="s2">&quot;OpenAI&quot;</span>
                <span class="n">provider_url</span> <span class="o">=</span> <span class="s2">&quot;https://openai.com/&quot;</span>  <span class="c1"># just for now.</span>

        <span class="k">if</span> <span class="n">provider_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">provider_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;organization&quot;</span><span class="p">:</span> <span class="n">provider_name</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">provider_url</span><span class="p">}</span>

        <span class="c1"># Convert skills</span>
        <span class="n">skills_data</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">skill</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">:</span>
            <span class="n">skill_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">skill</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">skill</span><span class="o">.</span><span class="n">tags</span><span class="p">),</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">examples</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skill_data</span><span class="p">[</span><span class="s2">&quot;examples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">skill</span><span class="o">.</span><span class="n">examples</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">inputModes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skill_data</span><span class="p">[</span><span class="s2">&quot;inputModes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">inputModes</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">skill</span><span class="o">.</span><span class="n">outputModes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">skill_data</span><span class="p">[</span><span class="s2">&quot;outputModes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">skill</span><span class="o">.</span><span class="n">outputModes</span><span class="p">]</span>

            <span class="n">skills_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skill_data</span><span class="p">)</span>

        <span class="c1"># Build capabilities dictionary</span>
        <span class="n">capabilities</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">streaming</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;streaming&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">streaming</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">pushNotifications</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;pushNotifications&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">pushNotifications</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">stateTransitionHistory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s2">&quot;stateTransitionHistory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="o">.</span><span class="n">stateTransitionHistory</span>
            <span class="p">)</span>

        <span class="c1"># Build authentication dictionary</span>
        <span class="n">auth_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;schemes&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">schemes</span><span class="p">)}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">credentials</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">auth_dict</span><span class="p">[</span><span class="s2">&quot;credentials&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authentication</span><span class="o">.</span><span class="n">credentials</span>

        <span class="c1"># Convert MimeType to string for input/output modes</span>
        <span class="n">input_modes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultInputModes</span><span class="p">]</span>
        <span class="n">output_modes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultOutputModes</span><span class="p">]</span>

        <span class="c1"># Build agent card</span>
        <span class="n">agent_card</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="n">capabilities</span><span class="p">,</span>
            <span class="s2">&quot;authentication&quot;</span><span class="p">:</span> <span class="n">auth_dict</span><span class="p">,</span>
            <span class="s2">&quot;defaultInputModes&quot;</span><span class="p">:</span> <span class="n">input_modes</span><span class="p">,</span>
            <span class="s2">&quot;defaultOutputModes&quot;</span><span class="p">:</span> <span class="n">output_modes</span><span class="p">,</span>
            <span class="s2">&quot;skills&quot;</span><span class="p">:</span> <span class="n">skills_data</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Add optional fields if they exist</span>
        <span class="k">if</span> <span class="n">provider_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;provider&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">provider_dict</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentationUrl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">agent_card</span><span class="p">[</span><span class="s2">&quot;documentationUrl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentationUrl</span>

        <span class="k">return</span> <span class="n">agent_card</span></div>


<div class="viewcode-block" id="Agent.has_tools">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.has_tools">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">has_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if this agent has configured tools.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the agent has tools, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Agent.start_mcp_servers">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.start_mcp_servers">[docs]</a>
    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_mcp_servers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager to connect and clean up MCP servers.</span>

<span class="sd">        This context manager ensures that all MCP servers are connected before the</span>
<span class="sd">        code block is executed and cleaned up after completion, even in case of exceptions.</span>

<span class="sd">        Yields:</span>
<span class="sd">            None: Does not return a value, just manages the context.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            async with agent.start_mcp_servers():</span>
<span class="sd">                # Operations that require connection to MCP servers</span>
<span class="sd">                result = await agent.run_async(&quot;Query to server&quot;)</span>
<span class="sd">            # Servers are automatically disconnected here</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
                <span class="n">server</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span></div>


<div class="viewcode-block" id="Agent.start_mcp_servers_async">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.start_mcp_servers_async">[docs]</a>
    <span class="nd">@asynccontextmanager</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">start_mcp_servers_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Asynchronous context manager to connect and clean up MCP servers.</span>

<span class="sd">        This method ensures that all MCP servers are connected before the</span>
<span class="sd">        code block is executed and cleaned up after completion, even in case of exceptions.</span>

<span class="sd">        Yields:</span>
<span class="sd">            None: Does not return a value, just manages the context.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            async with agent.start_mcp_servers():</span>
<span class="sd">                # Operations that require connection to MCP servers</span>
<span class="sd">                result = await agent.run_async(&quot;Query to server&quot;)</span>
<span class="sd">            # Servers are automatically disconnected here</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">connect_async</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">cleanup_async</span><span class="p">()</span></div>


<div class="viewcode-block" id="Agent.run">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">AgentInput</span> <span class="o">|</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">timeout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">trace_params</span><span class="p">:</span> <span class="n">TraceParams</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentRunOutput</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the agent synchronously with the provided input.</span>

<span class="sd">        This method is a synchronous wrapper for run_async, allowing</span>
<span class="sd">        easy use in synchronous contexts.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: The input for the agent, which can be of various types.</span>
<span class="sd">            timeout: Optional time limit in seconds for execution.</span>
<span class="sd">            trace_params: Optional trace parameters for observability purposes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AgentRunOutput[T_Schema]: The result of the agent execution.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Input as string</span>
<span class="sd">            result = agent.run(&quot;What is the weather in London?&quot;)</span>

<span class="sd">            # Input as UserMessage object</span>
<span class="sd">            from agentle.generations.models.messages.user_message import UserMessage</span>
<span class="sd">            from agentle.generations.models.message_parts.text import TextPart</span>

<span class="sd">            message = UserMessage(parts=[TextPart(text=&quot;What is the weather in London?&quot;)])</span>
<span class="sd">            result = agent.run(message)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">run_sync</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_async</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="nb">input</span><span class="p">,</span> <span class="n">trace_params</span><span class="o">=</span><span class="n">trace_params</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Agent.run_async">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.run_async">[docs]</a>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">run_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">AgentInput</span> <span class="o">|</span> <span class="n">Any</span><span class="p">,</span> <span class="n">trace_params</span><span class="p">:</span> <span class="n">TraceParams</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentRunOutput</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs the agent asynchronously with the provided input.</span>

<span class="sd">        This main method processes user input, interacts with the</span>
<span class="sd">        generation provider, and optionally calls tools until reaching a final response.</span>

<span class="sd">        The method supports both simple agents (without tools) and agents with</span>
<span class="sd">        tools that can perform iterative calls to solve complex tasks.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: The input for the agent, which can be of various types.</span>
<span class="sd">            trace_params: Optional trace parameters for observability purposes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AgentRunOutput[T_Schema]: The result of the agent execution, possibly</span>
<span class="sd">                                     with a structured response according to the defined schema.</span>

<span class="sd">        Raises:</span>
<span class="sd">            MaxToolCallsExceededError: If the maximum number of tool calls is exceeded.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Asynchronous use</span>
<span class="sd">            result = await agent.run_async(&quot;What&#39;s the weather like in London?&quot;)</span>

<span class="sd">            # Processing the response</span>
<span class="sd">            response_text = result.artifacts[0].parts[0].text</span>
<span class="sd">            print(response_text)</span>

<span class="sd">            # With structured response schema</span>
<span class="sd">            if result.parsed:</span>
<span class="sd">                location = result.parsed.location</span>
<span class="sd">                weather = result.parsed.weather</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_logger</span> <span class="o">=</span> <span class="n">Maybe</span><span class="p">(</span><span class="n">logger</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Logging with proper type ignore</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Starting agent run with input type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="nb">input</span><span class="p">)),</span>  <span class="c1"># type: ignore[reportGeneralTypeIssues, reportUnknownArgumentType]</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">generation_provider</span><span class="p">:</span> <span class="n">GenerationProvider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_provider</span>

        <span class="n">static_knowledge_prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Process static knowledge if any exists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_knowledge</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span><span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing static knowledge&quot;</span><span class="p">))</span>
            <span class="n">knowledge_contents</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">knowledge_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_knowledge</span><span class="p">:</span>
                <span class="c1"># Convert string to StaticKnowledge with NO_CACHE</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">knowledge_item</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">knowledge_item</span> <span class="o">=</span> <span class="n">StaticKnowledge</span><span class="p">(</span>
                        <span class="n">content</span><span class="o">=</span><span class="n">knowledge_item</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">NO_CACHE</span><span class="p">,</span> <span class="n">parse_timeout</span><span class="o">=</span><span class="mi">30</span>
                    <span class="p">)</span>

                <span class="c1"># Process the knowledge item based on its content type</span>
                <span class="n">content_to_parse</span> <span class="o">=</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">content</span>
                <span class="n">parsed_content</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">cache_key</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_parser</span> <span class="ow">or</span> <span class="n">file_parser_default_factory</span><span class="p">(</span>
                    <span class="n">visual_description_provider</span><span class="o">=</span><span class="n">generation_provider</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_visual_description_provider</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_visual_description_provider</span><span class="p">,</span>
                    <span class="n">audio_description_provider</span><span class="o">=</span><span class="n">generation_provider</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_audio_description_provider</span> <span class="ow">is</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_audio_description_provider</span><span class="p">,</span>
                    <span class="n">parse_timeout</span><span class="o">=</span><span class="n">knowledge_item</span><span class="o">.</span><span class="n">parse_timeout</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Check if caching is enabled</span>
                <span class="k">if</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NO_CACHE</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using cache for knowledge item&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Import aiocache only when needed</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">aiocache</span><span class="w"> </span><span class="kn">import</span> <span class="n">cached</span>

                        <span class="c1"># Create a cache key based on the content</span>
                        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;static_knowledge_</span><span class="si">{</span><span class="nb">hash</span><span class="p">(</span><span class="n">content_to_parse</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="c1"># Define a cached version of the parse function</span>
                        <span class="nd">@cached</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
                            <span class="n">ttl</span><span class="o">=</span><span class="kc">None</span>
                            <span class="k">if</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">cache</span> <span class="o">==</span> <span class="s2">&quot;infinite&quot;</span>
                            <span class="k">else</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">cache</span><span class="p">,</span>
                            <span class="n">key</span><span class="o">=</span><span class="n">cache_key</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_cached_parsed_content</span><span class="p">(</span>
                            <span class="n">content_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ParsedDocument</span><span class="p">:</span>
                            <span class="k">return</span> <span class="k">await</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_async</span><span class="p">(</span><span class="n">content_path</span><span class="p">)</span>

                        <span class="c1"># Get parsed content, either from cache or newly parsed</span>
                        <span class="n">parsed_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">get_cached_parsed_content</span><span class="p">(</span>
                            <span class="n">content_to_parse</span>
                        <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                        <span class="c1"># If aiocache is not installed, just parse normally</span>
                        <span class="n">parsed_content</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># If no cached content (either cache not enabled or cache miss), parse directly</span>
                <span class="k">if</span> <span class="n">parsed_content</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">is_url</span><span class="p">():</span>
                        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing URL: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content_to_parse</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">parsed_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_async</span><span class="p">(</span><span class="n">content_to_parse</span><span class="p">)</span>
                        <span class="n">knowledge_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;## URL: </span><span class="si">{</span><span class="n">content_to_parse</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">parsed_content</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">is_file_path</span><span class="p">():</span>
                        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Parsing file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">content_to_parse</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">parsed_content</span> <span class="o">=</span> <span class="k">await</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_async</span><span class="p">(</span><span class="n">content_to_parse</span><span class="p">)</span>
                        <span class="n">knowledge_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;## Document: </span><span class="si">{</span><span class="n">parsed_content</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">parsed_content</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Raw text</span>
                        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using raw text knowledge&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">knowledge_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;## Information:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content_to_parse</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Use the cached content</span>
                    <span class="n">source_label</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;URL&quot;</span>
                        <span class="k">if</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">is_url</span><span class="p">()</span>
                        <span class="k">else</span> <span class="s2">&quot;Document&quot;</span>
                        <span class="k">if</span> <span class="n">knowledge_item</span><span class="o">.</span><span class="n">is_file_path</span><span class="p">()</span>
                        <span class="k">else</span> <span class="s2">&quot;Information&quot;</span>
                    <span class="p">)</span>
                    <span class="n">knowledge_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;## </span><span class="si">{</span><span class="n">source_label</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">content_to_parse</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">parsed_content</span><span class="o">.</span><span class="n">sections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">knowledge_contents</span><span class="p">:</span>
                <span class="n">static_knowledge_prompt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"># KNOWLEDGE BASE</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">knowledge_contents</span>
                <span class="p">)</span>

        <span class="n">instructions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_instructions_to_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">static_knowledge_prompt</span><span class="p">:</span>
            <span class="n">instructions</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">static_knowledge_prompt</span>

        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_input_to_context</span><span class="p">(</span>
            <span class="nb">input</span><span class="p">,</span> <span class="n">instructions</span><span class="o">=</span><span class="n">instructions</span>
        <span class="p">)</span>

        <span class="c1"># Start execution tracking</span>
        <span class="n">context</span><span class="o">.</span><span class="n">start_execution</span><span class="p">()</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Converted input to context with </span><span class="si">%d</span><span class="s2"> messages&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">message_history</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Using generation provider: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">generation_provider</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">mcp_tools</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">MCPServerProtocol</span><span class="p">,</span> <span class="n">MCPTool</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">):</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Getting tools from MCP servers&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">:</span>
                <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">list_tools_async</span><span class="p">()</span>
                <span class="n">mcp_tools</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">server</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">)</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Got </span><span class="si">%d</span><span class="s2"> tools from MCP servers&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">agent_has_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_tools</span><span class="p">()</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">mcp_tools</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Agent has tools: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">agent_has_tools</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">agent_has_tools</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;No tools available, generating direct response&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">generation</span><span class="p">:</span> <span class="n">Generation</span><span class="p">[</span>
                <span class="n">T_Schema</span>
            <span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">generation_provider</span><span class="o">.</span><span class="n">create_generation_async</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">message_history</span><span class="p">,</span>
                <span class="n">response_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">response_schema</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">generation_config</span>
                <span class="k">if</span> <span class="n">trace_params</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">generation_config</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span>
                    <span class="n">new_trace_params</span><span class="o">=</span><span class="n">trace_params</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Generated response with </span><span class="si">%d</span><span class="s2"> tokens&quot;</span><span class="p">,</span> <span class="n">generation</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Update context with final generation and complete execution</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">generation</span><span class="o">.</span><span class="n">usage</span><span class="p">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">complete_execution</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">AgentRunOutput</span><span class="p">(</span>
                <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                <span class="n">parsed</span><span class="o">=</span><span class="n">generation</span><span class="o">.</span><span class="n">parsed</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Agent has tools. We must iterate until generate the final answer.</span>

        <span class="n">all_tools</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">Tool</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Tool</span><span class="o">.</span><span class="n">from_mcp_tool</span><span class="p">(</span><span class="n">mcp_tool</span><span class="o">=</span><span class="n">tool</span><span class="p">,</span> <span class="n">server</span><span class="o">=</span><span class="n">server</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">server</span><span class="p">,</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">mcp_tools</span>
        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
            <span class="n">Tool</span><span class="o">.</span><span class="n">from_callable</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span> <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span> <span class="k">else</span> <span class="n">tool</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span>
        <span class="p">]</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using </span><span class="si">%d</span><span class="s2"> tools in total&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_tools</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">available_tools</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tool</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">tool</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">all_tools</span>
        <span class="p">}</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">RunState</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]</span><span class="o">.</span><span class="n">init_state</span><span class="p">()</span>
        <span class="c1"># Convert all tools in the array to Tool objects</span>
        <span class="n">called_tools</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ToolExecutionSuggestion</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">while</span> <span class="n">state</span><span class="o">.</span><span class="n">iteration</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">maxIterations</span><span class="p">:</span>
            <span class="n">current_iteration</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Starting iteration </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">current_iteration</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">maxIterations</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Remove the filtering of tools that have already been called</span>
            <span class="c1"># since we want to allow calling the same tool multiple times</span>
            <span class="n">called_tools_prompt</span><span class="p">:</span> <span class="n">UserMessage</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">called_tools</span><span class="p">:</span>
                <span class="n">called_tools_prompt_parts</span><span class="p">:</span> <span class="n">MutableSequence</span><span class="p">[</span><span class="n">TextPart</span> <span class="o">|</span> <span class="n">FilePart</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">suggestion</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">called_tools</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">FilePart</span><span class="p">):</span>
                        <span class="n">called_tools_prompt_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                            <span class="p">[</span>
                                <span class="n">TextPart</span><span class="p">(</span>
                                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;&lt;info&gt;&lt;tool_name&gt;</span><span class="si">{</span><span class="n">suggestion</span><span class="o">.</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&lt;/tool_name&gt;&lt;args&gt;</span><span class="si">{</span><span class="n">suggestion</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2">&lt;/args&gt;&lt;result&gt;The following is a file that was generated by the tool:&lt;/info&gt;&quot;</span>
                                <span class="p">),</span>
                                <span class="n">result</span><span class="p">,</span>
                                <span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&lt;/result&gt;&quot;</span><span class="p">),</span>
                            <span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">called_tools_prompt_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">TextPart</span><span class="p">(</span>
                                <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;info&gt;</span>
<span class="s2">                                The following is a tool call made by the agent.</span>
<span class="s2">                                Only call it again if you think it&#39;s necessary.</span>
<span class="s2">                                &lt;/info&gt;&quot;&quot;&quot;</span>
                                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="p">[</span>
                                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;tool_execution&gt;</span>
<span class="s2">                                &lt;tool_name&gt;</span><span class="si">{</span><span class="n">suggestion</span><span class="o">.</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&lt;/tool_name&gt;</span>
<span class="s2">                                &lt;args&gt;</span><span class="si">{</span><span class="n">suggestion</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2">&lt;/args&gt;</span>
<span class="s2">                                &lt;result&gt;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&lt;/result&gt;</span>
<span class="s2">                            &lt;/tool_execution&gt;&quot;&quot;&quot;</span>
                                    <span class="p">]</span>
                                <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                <span class="n">called_tools_prompt</span> <span class="o">=</span> <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="n">called_tools_prompt_parts</span><span class="p">)</span>

            <span class="c1"># We no longer decide if there are no more tools since we allow repeated tool calls</span>
            <span class="c1"># Instead, we&#39;ll rely on the agent to stop calling tools when it has all needed information</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Generating tool call response&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">tool_call_generation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">generation_provider</span><span class="o">.</span><span class="n">create_generation_async</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">messages</span><span class="o">=</span><span class="n">MessageSequence</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">message_history</span><span class="p">)</span>
                <span class="o">.</span><span class="n">append_before_last_message</span><span class="p">(</span><span class="n">called_tools_prompt</span><span class="p">)</span>
                <span class="o">.</span><span class="n">elements</span><span class="p">,</span>
                <span class="n">generation_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">generation_config</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">all_tools</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Tool call generation completed with </span><span class="si">%d</span><span class="s2"> tool calls&quot;</span><span class="p">,</span>
                    <span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls_amount</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Update context with token usage from this generation</span>
            <span class="n">context</span><span class="o">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">usage</span><span class="p">)</span>

            <span class="n">agent_didnt_call_any_tool</span> <span class="o">=</span> <span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls_amount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">agent_didnt_call_any_tool</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Agent didn&#39;t call any tool, generating final response&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># Only make another call if we need structured output or didn&#39;t get text</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">tool_call_generation</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Generating structured response&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">generation</span> <span class="o">=</span> <span class="k">await</span> <span class="n">generation_provider</span><span class="o">.</span><span class="n">create_generation_async</span><span class="p">(</span>
                        <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                        <span class="n">messages</span><span class="o">=</span><span class="n">context</span><span class="o">.</span><span class="n">message_history</span><span class="p">,</span>
                        <span class="n">response_schema</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">response_schema</span><span class="p">,</span>
                        <span class="n">generation_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">generation_config</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Final generation complete&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1"># Update context with final generation and complete execution</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">update_token_usage</span><span class="p">(</span><span class="n">generation</span><span class="o">.</span><span class="n">usage</span><span class="p">)</span>
                    <span class="n">context</span><span class="o">.</span><span class="n">complete_execution</span><span class="p">()</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_agent_run_output</span><span class="p">(</span>
                        <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="n">generation</span><span class="o">=</span><span class="n">generation</span>
                    <span class="p">)</span>

                <span class="c1"># If we got text and don&#39;t need structure, use what we have</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using existing text response&quot;</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># Complete execution before returning</span>
                <span class="n">context</span><span class="o">.</span><span class="n">complete_execution</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_agent_run_output</span><span class="p">(</span>
                    <span class="n">generation</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Generation</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">],</span> <span class="n">tool_call_generation</span><span class="p">),</span>
                    <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Agent called one tool. We must call the tool and update the state.</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Processing </span><span class="si">%d</span><span class="s2"> tool calls&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Create a step to track this iteration&#39;s tool executions</span>
            <span class="n">step_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">Step</span><span class="p">(</span>
                <span class="n">step_type</span><span class="o">=</span><span class="s2">&quot;tool_execution&quot;</span><span class="p">,</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">current_iteration</span><span class="p">,</span>
                <span class="n">tool_execution_suggestions</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">),</span>
                <span class="n">generation_text</span><span class="o">=</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">token_usage</span><span class="o">=</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">tool_execution_suggestion</span> <span class="ow">in</span> <span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Executing tool: </span><span class="si">%s</span><span class="s2"> with args: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">tool_execution_suggestion</span><span class="o">.</span><span class="n">tool_name</span><span class="p">,</span>
                        <span class="n">tool_execution_suggestion</span><span class="o">.</span><span class="n">args</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">selected_tool</span> <span class="o">=</span> <span class="n">available_tools</span><span class="p">[</span><span class="n">tool_execution_suggestion</span><span class="o">.</span><span class="n">tool_name</span><span class="p">]</span>

                <span class="c1"># Time the tool execution</span>
                <span class="n">tool_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">tool_result</span> <span class="o">=</span> <span class="n">selected_tool</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">**</span><span class="n">tool_execution_suggestion</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="n">tool_execution_time</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tool_start_time</span>
                <span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Convert to milliseconds</span>

                <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Tool execution result: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tool_result</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">called_tools</span><span class="p">[</span><span class="n">tool_execution_suggestion</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">tool_execution_suggestion</span><span class="p">,</span>
                    <span class="n">tool_result</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Add the tool execution result to the step</span>
                <span class="n">step</span><span class="o">.</span><span class="n">add_tool_execution_result</span><span class="p">(</span>
                    <span class="n">suggestion</span><span class="o">=</span><span class="n">tool_execution_suggestion</span><span class="p">,</span>
                    <span class="n">result</span><span class="o">=</span><span class="n">tool_result</span><span class="p">,</span>
                    <span class="n">execution_time_ms</span><span class="o">=</span><span class="n">tool_execution_time</span><span class="p">,</span>
                    <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Complete the step and add it to context</span>
            <span class="n">step_duration</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">step_start_time</span>
            <span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Convert to milliseconds</span>
            <span class="n">step</span><span class="o">.</span><span class="n">mark_completed</span><span class="p">(</span><span class="n">duration_ms</span><span class="o">=</span><span class="n">step_duration</span><span class="p">)</span>
            <span class="n">context</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>

            <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">last_response</span><span class="o">=</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                <span class="n">tool_calls_amount</span><span class="o">=</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">tool_calls_amount</span><span class="p">(),</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">token_usage</span><span class="o">=</span><span class="n">tool_call_generation</span><span class="o">.</span><span class="n">usage</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">bind_optional</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">log</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Max tool calls exceeded after </span><span class="si">%d</span><span class="s2"> iterations&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">maxIterations</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Mark context as failed due to max iterations exceeded</span>
        <span class="n">context</span><span class="o">.</span><span class="n">fail_execution</span><span class="p">(</span>
            <span class="n">error_message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Max tool calls exceeded after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">maxIterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span>
        <span class="p">)</span>

        <span class="k">raise</span> <span class="n">MaxToolCallsExceededError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Max tool calls exceeded after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">agent_config</span><span class="o">.</span><span class="n">maxIterations</span><span class="si">}</span><span class="s2"> iterations&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Agent.clone">
<a class="viewcode-back" href="../../../api/agents.html#agentle.agents.agent.Agent.clone">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clone</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">new_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_tools</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Tool</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">object</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_config</span><span class="p">:</span> <span class="n">AgentConfig</span> <span class="o">|</span> <span class="n">AgentConfigDict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_documentation_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_capabilities</span><span class="p">:</span> <span class="n">Capabilities</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_authentication</span><span class="p">:</span> <span class="n">Authentication</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_default_input_modes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_default_output_modes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_skills</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">AgentSkill</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_mcp_servers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">MCPServerProtocol</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_generation_provider</span><span class="p">:</span> <span class="n">GenerationProvider</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">new_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Agent</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a clone of the current agent with optionally modified attributes.</span>

<span class="sd">        This method facilitates creating variations of an agent without modifying the original.</span>
<span class="sd">        Unspecified parameters will retain the values from the original agent.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_name: New name for the agent.</span>
<span class="sd">            new_instructions: New instructions for the agent.</span>
<span class="sd">            new_tools: New tools for the agent.</span>
<span class="sd">            new_config: New configuration for the agent.</span>
<span class="sd">            new_model: New model for the agent.</span>
<span class="sd">            new_version: New version for the agent.</span>
<span class="sd">            new_documentation_url: New documentation URL for the agent.</span>
<span class="sd">            new_capabilities: New capabilities for the agent.</span>
<span class="sd">            new_authentication: New authentication for the agent.</span>
<span class="sd">            new_default_input_modes: New default input modes for the agent.</span>
<span class="sd">            new_default_output_modes: New default output modes for the agent.</span>
<span class="sd">            new_skills: New skills for the agent.</span>
<span class="sd">            new_mcp_servers: New MCP servers for the agent.</span>
<span class="sd">            new_generation_provider: New generation provider for the agent.</span>
<span class="sd">            new_url: New URL for the agent.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Agent[T_Schema]: A new agent with the specified attributes modified.</span>

<span class="sd">        Example:</span>
<span class="sd">            ```python</span>
<span class="sd">            # Create a variation of the agent with different instructions</span>
<span class="sd">            weather_agent_fr = weather_agent.clone(</span>
<span class="sd">                new_name=&quot;French Weather Agent&quot;,</span>
<span class="sd">                new_instructions=&quot;You are a weather agent that can answer questions about the weather in French.&quot;</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Agent</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">](</span>
            <span class="n">name</span><span class="o">=</span><span class="n">new_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">instructions</span><span class="o">=</span><span class="n">new_instructions</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">instructions</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">new_tools</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">,</span>
            <span class="n">config</span><span class="o">=</span><span class="n">new_config</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">new_model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="n">new_version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">documentationUrl</span><span class="o">=</span><span class="n">new_documentation_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">documentationUrl</span><span class="p">,</span>
            <span class="n">capabilities</span><span class="o">=</span><span class="n">new_capabilities</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">capabilities</span><span class="p">,</span>
            <span class="n">authentication</span><span class="o">=</span><span class="n">new_authentication</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">authentication</span><span class="p">,</span>
            <span class="n">defaultInputModes</span><span class="o">=</span><span class="n">new_default_input_modes</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultInputModes</span><span class="p">,</span>
            <span class="n">defaultOutputModes</span><span class="o">=</span><span class="n">new_default_output_modes</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultOutputModes</span><span class="p">,</span>
            <span class="n">skills</span><span class="o">=</span><span class="n">new_skills</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">skills</span><span class="p">,</span>
            <span class="n">mcp_servers</span><span class="o">=</span><span class="n">new_mcp_servers</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mcp_servers</span><span class="p">,</span>
            <span class="n">generation_provider</span><span class="o">=</span><span class="n">new_generation_provider</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_provider</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">new_url</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_build_agent_run_output</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span>
        <span class="n">generation</span><span class="p">:</span> <span class="n">Generation</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentRunOutput</span><span class="p">[</span><span class="n">T_Schema</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an AgentRunOutput object from the generation results.</span>

<span class="sd">        This internal method creates the standardized output structure of the agent,</span>
<span class="sd">        including artifacts, usage statistics, and final context.</span>

<span class="sd">        Args:</span>
<span class="sd">            artifacts: Optional sequence of pre-built artifacts.</span>
<span class="sd">            artifact_name: Name of the artifact to be created (if artifacts is not provided).</span>
<span class="sd">            artifact_description: Description of the artifact to be created.</span>
<span class="sd">            artifact_metadata: Optional metadata for the artifact.</span>
<span class="sd">            context: The final context of the execution.</span>
<span class="sd">            generation: The Generation object produced by the provider.</span>
<span class="sd">            task_status: The state of the task (default: COMPLETED).</span>
<span class="sd">            append: Whether the artifact should be appended to existing artifacts.</span>
<span class="sd">            last_chunk: Whether this is the last chunk of the artifact.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AgentRunOutput[T_Schema]: The structured result of the agent execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parsed</span> <span class="o">=</span> <span class="n">generation</span><span class="o">.</span><span class="n">parsed</span>

        <span class="k">return</span> <span class="n">AgentRunOutput</span><span class="p">(</span>
            <span class="n">generation</span><span class="o">=</span><span class="n">generation</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
            <span class="n">parsed</span><span class="o">=</span><span class="n">parsed</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_instructions_to_str</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Prompt</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the instructions to a string.</span>

<span class="sd">        This internal method handles the different formats that instructions</span>
<span class="sd">        can have: simple string, callable that returns string, or sequence of strings.</span>

<span class="sd">        Args:</span>
<span class="sd">            instructions: The instructions in any supported format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The instructions converted to string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">instructions</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instructions</span><span class="p">,</span> <span class="n">Prompt</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">instructions</span><span class="o">.</span><span class="n">text</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">instructions</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">instructions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">instructions</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_input_to_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="nb">input</span><span class="p">:</span> <span class="n">AgentInput</span> <span class="o">|</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">instructions</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts user input to a Context object.</span>

<span class="sd">        This internal method converts the various supported input types to</span>
<span class="sd">        a standardized Context object that contains the messages to be processed.</span>

<span class="sd">        Supports a wide variety of input types, from simple strings to</span>
<span class="sd">        complex objects like DataFrames, images, files, and Pydantic models.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: The input in any supported format.</span>
<span class="sd">            instructions: The agent instructions as a string.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Context: A Context object containing the messages to be processed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">developer_message</span> <span class="o">=</span> <span class="n">DeveloperMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">instructions</span><span class="p">)])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Context</span><span class="p">):</span>
            <span class="c1"># If it&#39;s already a Context, return it as is.</span>
            <span class="k">return</span> <span class="nb">input</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">UserMessage</span><span class="p">):</span>
            <span class="c1"># If it&#39;s a UserMessage, prepend the developer instructions.</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span><span class="n">message_history</span><span class="o">=</span><span class="p">[</span><span class="n">developer_message</span><span class="p">,</span> <span class="nb">input</span><span class="p">])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Handle plain string input</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">input</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">TextPart</span><span class="p">,</span> <span class="n">FilePart</span><span class="p">,</span> <span class="n">Tool</span><span class="p">)):</span>
            <span class="c1"># Handle single message parts</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span>
                        <span class="n">parts</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TextPart</span> <span class="o">|</span> <span class="n">FilePart</span> <span class="o">|</span> <span class="n">Tool</span><span class="p">],</span> <span class="p">[</span><span class="nb">input</span><span class="p">])</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Tool</span><span class="p">):</span>
            <span class="c1"># Handle callable input (that&#39;s not a Tool)</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">()))]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="c1"># Handle pandas DataFrame if available</span>
        <span class="k">elif</span> <span class="n">HAS_PANDAS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
                    <span class="c1"># Convert DataFrame to Markdown</span>
                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span>
                                <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">input</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)]</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Handle numpy arrays if available</span>
        <span class="k">elif</span> <span class="n">HAS_NUMPY</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="c1"># Convert NumPy array to string representation</span>
                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array2string</span><span class="p">(</span><span class="nb">input</span><span class="p">))]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="c1"># Handle PIL images if available</span>
        <span class="k">elif</span> <span class="n">HAS_PIL</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
                    <span class="kn">import</span><span class="w"> </span><span class="nn">io</span>

                    <span class="n">img_byte_arr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
                    <span class="n">img_format</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;PNG&quot;</span>
                    <span class="nb">input</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_byte_arr</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">img_format</span><span class="p">)</span>
                    <span class="n">img_byte_arr</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                    <span class="n">mime_type_map</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;PNG&quot;</span><span class="p">:</span> <span class="s2">&quot;image/png&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;JPEG&quot;</span><span class="p">:</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;JPG&quot;</span><span class="p">:</span> <span class="s2">&quot;image/jpeg&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;GIF&quot;</span><span class="p">:</span> <span class="s2">&quot;image/gif&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;WEBP&quot;</span><span class="p">:</span> <span class="s2">&quot;image/webp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;BMP&quot;</span><span class="p">:</span> <span class="s2">&quot;image/bmp&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;TIFF&quot;</span><span class="p">:</span> <span class="s2">&quot;image/tiff&quot;</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="n">mime_type</span> <span class="o">=</span> <span class="n">mime_type_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">img_format</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;image/</span><span class="si">{</span><span class="n">img_format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span>
                                <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
                                    <span class="n">FilePart</span><span class="p">(</span>
                                        <span class="n">data</span><span class="o">=</span><span class="n">img_byte_arr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">(),</span>
                                        <span class="n">mime_type</span><span class="o">=</span><span class="n">mime_type</span><span class="p">,</span>
                                    <span class="p">)</span>
                                <span class="p">]</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="c1"># Try decoding bytes, otherwise provide a description</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Input is binary data of size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes.&quot;</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
            <span class="c1"># Convert datetime objects to ISO format string</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">input</span><span class="o">.</span><span class="n">isoformat</span><span class="p">())]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
            <span class="c1"># Read file content if it&#39;s a file path that exists</span>
            <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">file_content</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">file_content</span><span class="p">)]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="c1"># Fallback to string representation if reading fails</span>
                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span>
                                <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
                                    <span class="n">TextPart</span><span class="p">(</span>
                                        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to read file </span><span class="si">{</span><span class="nb">input</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                                    <span class="p">)</span>
                                <span class="p">]</span>
                            <span class="p">),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If it&#39;s not a file or doesn&#39;t exist, use the string representation</span>
                <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                    <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">developer_message</span><span class="p">,</span>
                        <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">))]),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Prompt</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">input</span><span class="o">.</span><span class="n">text</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="n">BytesIO</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">)):</span>
            <span class="c1"># Read content from BytesIO/StringIO</span>
            <span class="nb">input</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ensure reading from the start</span>
            <span class="n">content</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Input is binary data stream of size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s2"> bytes.&quot;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># str</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">ParsedDocument</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="nb">input</span><span class="o">.</span><span class="n">md</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Sequence handling: Check for Message sequences or Part sequences</span>
        <span class="c1"># Explicitly check for Sequence for MyPy&#39;s benefit</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>  <span class="c1"># pyright: ignore[reportUnnecessaryIsInstance]</span>
            <span class="c1"># Check if it&#39;s a sequence of Messages or Parts (AFTER specific types)</span>
            <span class="k">if</span> <span class="nb">input</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">AssistantMessage</span><span class="p">,</span> <span class="n">DeveloperMessage</span><span class="p">,</span> <span class="n">UserMessage</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># Sequence of Messages</span>
                <span class="c1"># Ensure it&#39;s a list of Messages for type consistency</span>
                <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                    <span class="n">message_history</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span>
                        <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">DeveloperMessage</span> <span class="o">|</span> <span class="n">UserMessage</span><span class="p">],</span> <span class="nb">input</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">input</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">TextPart</span><span class="p">,</span> <span class="n">FilePart</span><span class="p">,</span> <span class="n">Tool</span><span class="p">)):</span>
                <span class="c1"># Sequence of Parts</span>
                <span class="c1"># Ensure it&#39;s a list of the correct Part types</span>
                <span class="n">valid_parts</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">TextPart</span> <span class="o">|</span> <span class="n">FilePart</span> <span class="o">|</span> <span class="n">Tool</span><span class="p">],</span> <span class="nb">input</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                    <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                        <span class="n">developer_message</span><span class="p">,</span>
                        <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">valid_parts</span><span class="p">)),</span>
                    <span class="p">]</span>
                <span class="p">)</span>

        <span class="c1"># Handle Pydantic models if available</span>
        <span class="k">elif</span> <span class="n">HAS_PYDANTIC</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span> <span class="k">as</span> <span class="n">PydanticBaseModel</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">PydanticBaseModel</span><span class="p">):</span>
                    <span class="c1"># Convert Pydantic model to JSON string</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                        <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">developer_message</span><span class="p">,</span>
                            <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;```json</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">```&quot;</span><span class="p">)]),</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">pass</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">)):</span>
            <span class="c1"># Convert dict, list, tuple, set, frozenset to JSON string</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Use json.dumps for serialization</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                    <span class="nb">input</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span>
                <span class="p">)</span>  <span class="c1"># Add default=str for non-serializable</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># Fallback to string representation if json fails</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Input is a collection: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span><span class="w"> </span><span class="nb">input</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>
                <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">developer_message</span><span class="p">,</span>
                    <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;```json</span><span class="se">\n</span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">```&quot;</span><span class="p">)]),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Fallback for any unhandled type</span>
        <span class="c1"># Convert to string representation as a last resort</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Use safer type handling</span>
            <span class="n">input_type_name</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>  <span class="c1"># type: ignore[reportGeneralTypeIssues, reportUnknownArgumentType]</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>  <span class="c1"># type: ignore[reportGeneralTypeIssues, reportUnknownArgumentType]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Use safer type handling</span>
            <span class="n">input_type_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;unknown&quot;</span>  <span class="c1"># Fall back to a string if we can&#39;t get the type name</span>
            <span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Input of type </span><span class="si">{</span><span class="n">input_type_name</span><span class="si">}</span><span class="s2"> could not be converted to string&quot;</span>

        <span class="k">return</span> <span class="n">Context</span><span class="p">(</span>  <span class="c1"># type: ignore[reportGeneralTypeIssues, reportUnknownArgumentType]</span>
            <span class="n">message_history</span><span class="o">=</span><span class="p">[</span>
                <span class="n">developer_message</span><span class="p">,</span>
                <span class="n">UserMessage</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">TextPart</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)]),</span>  <span class="c1"># type: ignore[reportGeneralTypeIssues, reportUnknownArgumentType]</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Agent</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AgentTeam</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">agentle.agents.agent_team</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentTeam</span>

        <span class="k">return</span> <span class="n">AgentTeam</span><span class="p">(</span>
            <span class="n">agents</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span>
            <span class="n">orchestrator_provider</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generation_provider</span><span class="p">,</span>
            <span class="n">orchestrator_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation_provider</span><span class="o">.</span><span class="n">default_model</span><span class="p">,</span>
        <span class="p">)</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Agentle Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../../../_static/documentation_options.js?v=38b66d78"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>